{% extends "base.html" %}
{% block title %}Billing & Créditos | WHAGO{% endblock %}
{% block head %}
<script src="https://sdk.mercadopago.com/js/v2"></script>
{% endblock %}
{% block content %}
<section class="grid gap-6 lg:grid-cols-2">
  <article class="card" id="subscription-card">
    <div class="card__header">
      <h2 class="card__title">Assinatura atual</h2>
      <p class="card__subtitle">Resumo do plano, vigência e gerenciamento de assinatura.</p>
    </div>
    <dl class="grid gap-4 text-sm md:grid-cols-2">
      <div>
        <dt class="text-slate-500">Plano ativo</dt>
        <dd class="text-lg font-semibold text-slate-900" id="billing-current-plan">--</dd>
      </div>
      <div>
        <dt class="text-slate-500">Status da assinatura</dt>
        <dd class="text-lg font-semibold" id="billing-subscription-status">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
            Sem assinatura
          </span>
        </dd>
      </div>
      <div>
        <dt class="text-slate-500">Próxima renovação</dt>
        <dd class="text-lg font-semibold text-slate-900" id="billing-renewal">--</dd>
      </div>
      <div>
        <dt class="text-slate-500">Gateway de pagamento</dt>
        <dd class="text-lg font-semibold text-slate-900" id="billing-gateway">--</dd>
      </div>
      <div class="md:col-span-2" id="subscription-dates-container" style="display: none;">
        <dt class="text-slate-500">Iniciada em</dt>
        <dd class="text-sm text-slate-700" id="billing-started-at">--</dd>
      </div>
    </dl>
    <div class="mt-6 flex gap-3">
      <button id="cancel-subscription-btn" class="btn-danger hidden">
        Cancelar Assinatura
      </button>
      <button id="change-payment-method-btn" class="btn-secondary hidden">
        Alterar Forma de Pagamento
      </button>
    </div>
    <p id="subscription-feedback" class="mt-4 text-sm text-slate-500" aria-live="polite"></p>
  </article>

  <article class="card">
    <div class="card__header">
      <h2 class="card__title">Alterar plano</h2>
      <p class="card__subtitle">Realize upgrade imediato ou agende downgrade para o próximo ciclo.</p>
    </div>
    <form id="plan-change-form" class="space-y-4">
      <div class="space-y-2">
        <label for="plan-select" class="text-sm font-medium text-slate-600">Selecionar plano</label>
        <select id="plan-select" name="plan_slug" class="input">
          <option value="free">Free</option>
          <option value="business">Business</option>
          <option value="enterprise">Enterprise</option>
        </select>
      </div>
      <div class="space-y-2">
        <label class="text-sm font-medium text-slate-600">Método de pagamento</label>
        <select id="plan-payment-method" class="input">
          <option value="card">Cartão de crédito</option>
          <option value="pix">PIX</option>
          <option value="boleto">Boleto</option>
        </select>
      </div>
      <button type="submit" class="btn-primary w-full">Confirmar alteração</button>
      <p id="plan-change-feedback" class="text-sm text-slate-500"></p>
    </form>
  </article>
</section>

<section class="mt-8 grid gap-6 lg:grid-cols-2">
  <article class="card">
    <div class="card__header">
      <h2 class="card__title">Comprar créditos avulsos</h2>
      <p class="card__subtitle">Adicione créditos à sua conta para enviar mais mensagens.</p>
    </div>
    <form id="credit-purchase-form" class="space-y-4">
      <div class="space-y-2">
        <label for="credit-amount" class="text-sm font-medium text-slate-600">Quantidade de créditos</label>
        <input 
          type="number" 
          id="credit-amount" 
          class="input" 
          min="100" 
          step="100" 
          value="1000"
          placeholder="Ex: 1000"
        />
        <p class="text-xs text-slate-500">
          Valor: R$ <span id="credit-price">100.00</span> (R$ 0,10 por crédito)
        </p>
      </div>
      <div class="space-y-2">
        <label for="credit-payment-method" class="text-sm font-medium text-slate-600">Forma de pagamento</label>
        <select id="credit-payment-method" class="input">
          <!-- Options will be loaded dynamically -->
        </select>
      </div>
      <button type="submit" class="btn-primary w-full">
        Comprar Créditos
      </button>
      <p id="credit-purchase-feedback" class="text-sm text-slate-500" aria-live="polite" role="status"></p>
    </form>
  </article>

  <article class="card">
    <div class="card__header">
      <h2 class="card__title">Histórico econômico</h2>
      <p class="card__subtitle">Últimas transações e lançamentos no ledger de créditos.</p>
    </div>
    <div class="space-y-4 text-sm">
      <div>
        <h3 class="font-medium text-slate-700">Transações recentes</h3>
        <ul id="transaction-list" class="mt-2 space-y-2 text-slate-600">
          <li>Sem registros.</li>
        </ul>
      </div>
      <div>
        <h3 class="font-medium text-slate-700">Ledger de créditos</h3>
        <ul id="credit-history" class="mt-2 space-y-2 text-slate-600">
          <li>Sem movimentações.</li>
        </ul>
      </div>
    </div>
  </article>
</section>
{% endblock %}
